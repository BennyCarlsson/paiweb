(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,a){},126:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(7),i=a.n(o),c=(a(101),a(72)),u=a(73),l=a(86),s=a(74),d=a(87),p=a(84),f=a(177),m=a(172),h=a(12),g=a(9),v=a(134),b=a(135),E=a(158),w=a(159),O=a(160),y=a(161),x=a(164),j=a(163),S=a(167),k=a(176),T=a(22),C=a.n(T),N=(a(108),a(70),a(127),a(128),{apiKey:"AIzaSyCNrWqbvDNEp53wNfDtDMqfZbgStsJEM-E",authDomain:"paiweb.firebaseapp.com",databaseURL:"https://paiweb.firebaseio.com",projectId:"paiweb",storageBucket:"paiweb.appspot.com",messagingSenderId:"560094021764",appId:"1:560094021764:web:d9efaf85f4747eb1"}),D={apiKey:N.apiKey,authDomain:N.authDomain,databaseURL:N.databaseUrl,projectId:N.projectId,storageBucket:N.storageBucket,messagingSenderId:N.messagingSenderId,appId:N.appId};C.a.initializeApp(D),C.a.firestore().enablePersistence().catch(function(e){"failed-precondition"===e.code?console.log(e.code):"unimplemented"===e.code&&console.log(e.code)});var R=C.a,I=C.a.firestore(),P=function(){return{type:"LOGOUT",payload:{}}},L=function(){return{type:"SET_POSTS",payload:{allPosts:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}},U=function(){return{type:"SET_LOADING",payload:{loading:arguments.length>0&&void 0!==arguments[0]&&arguments[0]}}},A=function(e){return{type:"SET_LATEST_VALID_POST",payload:e}},W=function(e){return{type:"SET_GOT_LATEST_VALID_POST",payload:e}},B=Object(b.a)({root:{},grow:{flexGrow:1},avatar:{margin:0,padding:0,height:"24px",width:"24px"}})(function(e){var t=e.classes,a=r.a.useState(null),n=Object(h.a)(a,2),o=n[0],i=n[1],c=Boolean(o),u=Object(g.c)(function(e){return e.user}),l=Object(g.b)();return r.a.createElement("div",{className:t.root},r.a.createElement(E.a,{position:"static"},r.a.createElement(w.a,null,r.a.createElement(O.a,{variant:"h6",color:"inherit",className:t.grow},"Pai"),r.a.createElement(y.a,{color:"inherit",onClick:function(e){u.authenticated&&i(e.currentTarget)}},u.authenticated?r.a.createElement(j.a,{alt:"Remy Sharp",src:u.data.photoURL,className:t.avatar}):r.a.createElement(x.a,null,"account_circle")),r.a.createElement(k.a,{id:"menu-appbar",anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:c,onClose:function(){i(null)}},r.a.createElement(S.a,{onClick:function(){i(null),R.auth().signOut(),l(P())}},"Sign out")))))}),F=Object(b.a)(function(e){return{appBar:{top:"auto",bottom:0},toolbar:{alignItems:"center",justifyContent:"space-between"}}})(function(e){var t=e.classes;return r.a.createElement(E.a,{position:"sticky",color:"primary",className:t.appBar},r.a.createElement(w.a,{className:t.toolbar,variant:"dense"},r.a.createElement(y.a,{color:"inherit","aria-label":"Open drawer",onClick:e.toggleDrawer(!0)},r.a.createElement(x.a,null,"menu")),e.camera))}),_=a(27),z=(a(63),a(79),a(54)),V=a(80),M=function(e){var t=((new Date).getTime()-e.getTime())/1e3;return t<60?parseInt(t)+"s":t<3600?parseInt(t/60)+"m":t<=172800?parseInt(t/3600)+"h":t>172800?"< 2 days":void 0},G=function(e){var t=100-((new Date).getTime()/1e3-e.getTime()/1e3)/172800*100;return t<0?0:t>100?100:t},H=function(e,t,a,n){var r="images/"+t.uid+"/"+function(e){return Date.now()+e.name.substr(e.name.lastIndexOf("."))}(e);R.storage().ref(r).put(e,{cacheControl:"max-age=432001",contentType:e.type}).on("state_changed",function(e){},function(e){console.log("ERROR!",e)},function(){q(r,t,a,n)})},q=function(e,t,a,n){var r=I.batch();a.forEach(function(a){var n=I.collection("posts").doc();r.set(n,{uid:t.uid,userPhotoURL:t.photoURL,imgRef:e,timestamp:R.firestore.FieldValue.serverTimestamp(),groupId:a})}),r.commit().then(function(e){Y(t.uid).then(function(){n()})}).catch(function(e){console.error("Error adding document: ",e)})},J=function(e,t,a){I.collection("posts").doc(t).update(Object(z.a)({},"canvasDrawings.".concat(a),e))},Y=function(e){return I.collection("users").doc(e).update({lastUpdate:R.firestore.FieldValue.serverTimestamp()})},K=function(e){return I.collection("posts").where("timestamp",">",new Date(Date.now()-1728e5)).where("groupId","in",e).orderBy("timestamp","desc").limit(50).get().then(function(e){var t=[];return e.forEach(function(e){t.push(Object(_.a)({},e.data(),{postId:e.id}))}),t})},X=function(e){return I.collection("posts").where("timestamp",">",new Date(new Date-864e5)).where("uid","==",e).orderBy("timestamp","desc").limit(1).get().then(function(e){var t;return e.forEach(function(e){t=e.data()}),t})},$=a(81),Z=a.n($),Q=a(82),ee=a.n(Q),te=a(168),ae=a(85),ne=Object(v.a)(function(e){return{icon:{position:"absolute",bottom:"-16px",right:"50px"}}}),re=function(e){var t=e.undo,a=e.drawEnabled,o=ne();return r.a.createElement(n.Fragment,null,a?r.a.createElement(x.a,{fontSize:"large",className:o.icon,onClick:t,color:"secondary"},"undo"):"")},oe=Object(v.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"},touchActionNone:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00",touchAction:"none"}}}),ie=function(e){var t=oe(),a=Object(g.c)(function(e){return e.user.data.uid}),o=e.canvasDrawing,c=e.imageWrapperRef,u=e.postId,l=e.drawEnabled,s=Object(n.useRef)(),d=Object(n.useRef)([]),p=!1,f=Object(n.useRef)(),m=Object(n.useRef)(),h=Object(n.useCallback)(function(e,t){var a=s.current.getContext("2d");d.current.push({x:e,y:t}),a.beginPath(),a.strokeStyle="red",a.lineWidth=4,a.lineJoin="round",a.moveTo(f.current,m.current),a.lineTo(e,t),a.stroke(),a.closePath(),f.current=e,m.current=t},[]),v=Object(n.useCallback)(function(){f.current=void 0,m.current=void 0},[]);Object(n.useEffect)(function(){var e=new ResizeObserver(function(e){b(),o&&s.current?(d.current=[],v(),s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height),o.forEach(function(e){"up"===e?(d.current.push("up"),v()):h(e.x,e.y)})):s.current&&(d.current=[],s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height))});return e.observe(c.current),function(){try{e.disconnect()}catch(t){console.log("error",t)}}},[c,o,h,v]);var b=function(){s.current&&(s.current.style.width="100%",s.current.style.height="100%",s.current.width=s.current.offsetWidth,s.current.height=s.current.offsetHeight)},E=function(e,t){l&&("down"===e&&O(t),"move"===e&&y(t),"up"===e&&k(t))},w=function(){s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height);var e=Object(ae.a)(d.current);d.current=[],v(),e.forEach(function(e){"up"===e?(d.current.push("up"),v()):h(e.x,e.y)}),J(d.current,u,a)},O=function(e){p=!0},y=function(e){e.preventDefault();var t=function(e){var t=i.a.findDOMNode(s.current).getBoundingClientRect(),a=e.clientX,n=e.clientY;return e.changedTouches&&e.changedTouches.length>0&&(a=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY),{x:a-t.left,y:n-t.top}}(e),a=t.x,n=t.y;x(a,n)&&h(a,n)},x=function(e,t){return!(!p||!j(e,t))},j=function(e,t){return!m.current||!m.current||!(!S(e,f.current)&&!S(t,m.current))||void 0},S=function(e,t){return e-t>2||t-e>2},k=function(e){p&&"up"!==d.current[d.current.length-1]&&(d.current.push("up"),v(),J(d.current,u,a)),p=!1};return r.a.createElement(n.Fragment,null,r.a.createElement("canvas",{className:l?t.touchActionNone:t.canvas,onMouseDown:function(e){return E("down",e)},onTouchStart:function(e){return E("down",e)},onMouseMove:function(e){return E("move",e)},onTouchMove:function(e){return E("move",e)},onMouseUp:function(e){return E("up",e)},onTouchEnd:function(e){return E("up",e)},onMouseOut:function(e){return E("up",e)},onTouchCancel:function(e){return E("up",e)},ref:s}),r.a.createElement(re,{undo:function(){if(d.current&&d.current.length){var e=d.current,t=e.lastIndexOf("up",e.length-2)+1;d.current=e.slice(0,t),w()}},drawEnabled:l}))},ce=Object(v.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"}}}),ue=function(e){var t=e.canvasDrawings,a=e.imageWrapperRef,o=Object(n.useRef)(),i=ce(),c=Object(n.useRef)(),u=Object(n.useRef)(),l=Object(n.useCallback)(function(e,t){var a=o.current.getContext("2d");a.beginPath(),a.strokeStyle="red",a.lineWidth=4,a.lineJoin="round",a.moveTo(c.current,u.current),a.lineTo(e,t),a.stroke(),a.closePath(),c.current=e,u.current=t},[]),s=Object(n.useCallback)(function(){c.current=void 0,u.current=void 0},[]);Object(n.useEffect)(function(){new ResizeObserver(function(e){d(),function(){if(t&&o.current){s();var e=o.current.getContext("2d");for(var a in e.clearRect(0,0,o.width,o.height),t)t[a].forEach(function(e){"up"===e?s():l(e.x,e.y)})}}()}).observe(a.current)},[a,l,t,s]);var d=function(){o.current&&(o.current.style.width="100%",o.current.style.height="100%",o.current.width=o.current.offsetWidth,o.current.height=o.current.offsetHeight)};return r.a.createElement("canvas",{className:i.canvas,ref:o})},le=Object(v.a)(function(e){return{imgDiv:{borderRadius:"4px",minHeight:"75vh",maxHeight:"75vh",maxWidth:"450px",overflow:"hidden",position:"relative"},img:{position:"absolute",top:"0",bottom:"0",margin:"auto",borderRadius:"4px",boxShadow:"0px 1px 3px 0px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 2px 1px -1px rgba(0,0,0,0.12)"},progressWrapper:{widh:"100%",height:"75vh",display:"flex",justifyContent:"center",alignItems:"center"},progress:{color:e.palette.color.main}}}),se=function(e){var t=Object(n.useState)(""),a=Object(h.a)(t,2),o=a[0],i=a[1],c=Object(n.useState)(!1),u=Object(h.a)(c,2),l=u[0],s=u[1],d=Object(n.useRef)(),p=le(),f=Object(g.c)(function(e){return e.user.data.uid}),m=e.imageRef,v=e.drawEnabled,b=e.postId,E=e.canvasDrawings;Object(n.useEffect)(function(){return w(m)},[m]);var w=function(e){(function(e){if(e)return R.storage().ref(e).getDownloadURL().then(function(e){return e})})(e).then(function(e){return i(e)})};return r.a.createElement(ee.a,{onChange:function(e){s(e)},active:!l,offset:{top:100},partialVisibility:!0},r.a.createElement("div",{className:p.imgDiv,ref:d},l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Z.a,{width:"100%",height:"auto",src:o,alt:"image post",className:p.img,loader:r.a.createElement("div",{className:p.progressWrapper},r.a.createElement(te.a,{className:p.progress}))}),r.a.createElement(ue,{canvasDrawings:function(){if(E){var e=Object.assign({},E);return delete e[f],e}}(),imageWrapperRef:d}),r.a.createElement(ie,{drawEnabled:v,imageWrapperRef:d,postId:b,canvasDrawing:E&&E[f]}))))},de=a(133),pe=Object(de.a)(function(e){return{timeText:{textShadow:"0px 0px 6px #333030"},progress:{marginLeft:"5px",color:e.palette.color.main,zIndex:2},innerProgress:{position:"relative",marginLeft:"-16px",color:e.palette.gray.main,zIndex:1}}}),fe=function(e){var t=pe(),a=e.timestamp,o=e.progressValue,i=e.variant;return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"caption",className:t.timeText},a),r.a.createElement(te.a,{color:"primary",variant:i||"static",value:o,className:t.progress,size:16}),r.a.createElement(te.a,{variant:"static",value:100,className:t.innerProgress,size:16}))},me=Object(v.a)(function(e){return{icon:{position:"absolute",bottom:"-16px",right:"8px"}}}),he=function(e){var t=e.editDrawEnabled,a=e.drawEnabled,n=me();return r.a.createElement(x.a,{fontSize:"large",className:n.icon,onClick:t,color:a?"secondary":"disabled"},"brush")},ge=Object(v.a)(function(e){return{root:{scrollSnapAlign:"start",padding:"0px",paddingBottom:"24px",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},postWrapper:{position:"relative",width:"100%",maxWidth:"450px"},avatar:{border:"2px solid #fafafa",marginRight:"8px"},avatarTimeDiv:{position:"absolute",zIndex:2,display:"flex",padding:"8px",alignItems:"center"}}}),ve=function(e){var t=ge(),a=Object(n.useState)(!1),o=Object(h.a)(a,2),i=o[0],c=o[1],u=e.post;return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.postWrapper},r.a.createElement("div",{className:t.avatarTimeDiv},r.a.createElement(j.a,{className:t.avatar,alt:"Post Avatar",src:u.userPhotoURL}),r.a.createElement(fe,{progressValue:G(u.timestamp.toDate()),timestamp:M(u.timestamp.toDate())})),r.a.createElement(se,{drawEnabled:i,imageRef:u.imgRef,canvasDrawings:u.canvasDrawings,postId:u.postId}),r.a.createElement(he,{editDrawEnabled:function(){c(!i)},drawEnabled:i})))},be=Object(v.a)(function(e){return{root:{padding:"0px",minHeight:"78vh",height:"78vh",display:"flex",flexDirection:"column",justifyContent:"space-around",textAlign:"center",alignItems:"center"},"@keyframes arrowAnimation":{from:{transform:"translateY(0)"},to:{transform:"translateY(30px)"}},icon:{position:"relative",fontSize:"65px",animation:"$arrowAnimation 2s infinite alternate"}}}),Ee=function(){var e=be();return r.a.createElement("div",{className:e.root},r.a.createElement("div",null),r.a.createElement("span",null,r.a.createElement(O.a,{align:"center",variant:"h4"},"Show friends what you are up to.",r.a.createElement("br",null)," Post a picture.")),r.a.createElement(x.a,{color:"disabled",className:e.icon,fontSize:"large"},"arrow_downward"))},we=a(132),Oe=function(e){var t=ye();return e.members.map(function(e,a){return r.a.createElement(j.a,{key:"key"+a,alt:"Avatar photo",src:e.photoURL,className:t.avatar})})},ye=Object(v.a)(function(e){return{groupWrapper:{display:"flex",width:"100%",scrollSnapAlign:"start"},avatar:{marginLeft:"-6px",border:"2px solid white"},listItemWrapper:{display:"flex"},leftAvatarsLine:{width:"100%",borderTop:"1px solid white",marginLeft:"8px",marginTop:"35px",height:"16px"},rightAvatarsLine:{width:"100%",borderTop:"1px solid white",marginRight:"8px",marginTop:"35px",height:"16px"}}}),xe=function(e){var t=e.group,a=ye();return r.a.createElement("div",{className:a.groupWrapper},r.a.createElement("div",{className:a.leftAvatarsLine}),r.a.createElement("div",{className:a.listItemWrapper},r.a.createElement(we.a,null,Oe(t))),r.a.createElement("div",{className:a.rightAvatarsLine}))},je=Object(v.a)(function(e){return{root:{scrollSnapAlign:"start",padding:"0px",paddingBottom:"24px",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},postWrapper:{position:"relative",width:"100%",maxWidth:"450px",height:"75vh"},avatar:{border:"2px solid #fafafa",marginRight:"8px"},avatarTimeDiv:{position:"absolute",zIndex:2,display:"flex",padding:"8px",alignItems:"center"},icon:{position:"absolute",bottom:"-16px",right:"8px"}}}),Se=function(e){var t=je();return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.postWrapper},r.a.createElement("div",{className:t.avatarTimeDiv},r.a.createElement(j.a,{className:t.avatar,alt:"Post Avatar"}),r.a.createElement(fe,{timestamp:"...",variant:"indeterminate"})),r.a.createElement(x.a,{fontSize:"large",className:t.icon,color:"disabled"},"brush")))},ke=Object(v.a)(function(e){return{feedWrapper:{flexDirection:"column",overflowY:"scroll",scrollSnapType:"y mandatory",backgroundColor:e.palette.background.main},feedTopDiv:{scrollSnapAlign:"end"}}}),Te=function(e){var t=Object(n.useState)(!0),a=Object(h.a)(t,2),o=a[0],i=a[1],c=ke(),u=Object(g.c)(function(e){return e.user}),l=Object(g.c)(function(e){return e.feed}),s=Object(g.c)(function(e){return e.groups}),d=Object(g.c)(function(e){return e.latestValidPost}),p=d.latestValidPost,f=d.gotLatestPost,m=Object(g.b)();Object(n.useEffect)(function(){f&&s&&s.length&&i(!!p)},[p,f,m,s]),Object(n.useEffect)(function(){if(e.updateFeed&&s&&s.length){var t=s.map(function(e){return e.id});K(t).then(function(e){return m(L(e))}),i(!0)}},[e.updateFeed,u,m,s]);var v=function(e,t){return r.a.createElement(n.Fragment,{key:"key"+t},r.a.createElement(xe,{group:e}),b(e.id))},b=function(e){var t=l.allPosts.filter(function(t){return t.groupId===e});return l.loading?r.a.createElement(Se,null):t.map(function(e,t){return r.a.createElement(ve,{key:"post"+t,post:e})})};return r.a.createElement("div",{className:c.feedWrapper},r.a.createElement("div",{className:c.feedTopDiv}),o?s.map(function(e,t){return v(e,t)}):r.a.createElement(Ee,null))},Ce=a(174),Ne=a(175),De=a(169);function Re(e){return r.a.createElement(De.a,Object.assign({},e,{direction:"right"}))}var Ie=function(e){return r.a.createElement(Ne.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:1300,open:e.showSnackBar,onClose:e.handleCloseSnackBar,TransitionComponent:Re,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},e.snackBarText),action:[r.a.createElement(y.a,{key:"close","aria-label":"close",color:"inherit",onClose:e.handleCloseSnackBar},r.a.createElement(x.a,null,"close"))]})},Pe=a(170),Le=function(){var e=Object(g.c)(function(e){return e.user});return r.a.createElement(n.Fragment,null,"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===e.data.uid?r.a.createElement(Pe.a,{color:"secondary",onClick:function(){e.authenticated&&e.data&&function(e){I.collection("groups").add({uidList:[e.uid],members:[{uid:e.uid,photoURL:e.photoURL,displayName:e.displayName}]})}(e.data)}},"Create Group ",r.a.createElement(x.a,null,"add")):"")},Ue=a(166),Ae=function(e,t){if(e&&t){var a=t.filter(function(t){return t.uid===e}).sort(function(e,t){return e.timestamp.toDate().getTime()-t.timestamp.toDate().getTime()});return a[0]?M(a[a.length-1].timestamp.toDate()):"\ud83d\ude34"}},We=Object(v.a)(function(e){return{loadingText:{marginLeft:"16px"},avatar:{marginLeft:"-6px",border:"2px solid white"},groupButtonWrapper:{display:"flex",alignItems:"center"},timer:{margin:0}}}),Be=function(e){var t=We(),a=Object(g.c)(function(e){return e.groups}),o=Object(g.c)(function(e){return e.user}),i=Object(g.c)(function(e){return e.feed}).allPosts,c=Object(n.useState)(),u=Object(h.a)(c,2),l=u[0],s=u[1],d=function(e,a){return r.a.createElement("div",{key:"key"+a,className:t.groupButtonWrapper},r.a.createElement(we.a,null,p(e)),"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===o.data.uid?r.a.createElement(y.a,{onClick:function(){return f(e.id)}},r.a.createElement(x.a,null,"group_add")):"")},p=function(e){return e.members.map(function(e,a){return r.a.createElement("div",{key:"avatar"+a},r.a.createElement(j.a,{onClick:function(){return m(e)},key:"key"+a,alt:"Avatar photo",src:e.photoURL,className:t.avatar}),r.a.createElement("p",{className:t.timer},Ae(e.uid,i)))})},f=function(e){var t=window.location.href+"?groupId="+e;s(t),navigator.clipboard.writeText(t).then(function(){},function(e){console.error("Async: Could not copy text: ",e)})},m=function(t){e.setShowSnackBar(!0,"Notification to "+t.displayName),function(e){var t=R.functions().httpsCallable("sendPushNotificationTest");return t({toUid:e})}(t.uid).then(function(t){var a=t.data?"Sent Notification!":"Couldn't send notification";e.setShowSnackBar(!0,a)})};return r.a.createElement(Ue.a,null,a?r.a.createElement(r.a.Fragment,null,a.map(function(e,t){return d(e,t)}),r.a.createElement(O.a,{variant:"body2",color:"inherit",className:t.loadingText},l)):r.a.createElement(O.a,{variant:"body2",color:"inherit",className:t.loadingText},"loading groups.."))},Fe=Object(v.a)(function(e){return{drawerList:{height:"100%",width:"250px",display:"flex",paddingTop:"8px",flexDirection:"column",justifyContent:"space-between",backgroundColor:e.palette.background.main}}}),_e=function(e){var t=e.open,a=e.toggleDrawer,o=Fe(),i=Object(n.useState)(!1),c=Object(h.a)(i,2),u=c[0],l=c[1],s=Object(n.useState)("Push Notification"),d=Object(h.a)(s,2),p=d[0],f=d[1];return r.a.createElement(n.Fragment,null,r.a.createElement(Ie,{handleCloseSnackBar:function(){l(!1)},showSnackBar:u,snackBarText:p}),r.a.createElement(Ce.a,{open:t,onClose:a(!1),onOpen:a(!0)},r.a.createElement("div",{className:o.drawerList},r.a.createElement(Be,{setShowSnackBar:function(e,t){l(e),f(t)}}),r.a.createElement(Le,null),r.a.createElement(O.a,{variant:"body2",gutterBottom:!0},"Beta v.0.2.2"))))},ze=a(171),Ve=Object(b.a)(function(e){return{fabButton:{position:"absolute",zIndex:2,top:"-29px",left:0,right:0,margin:"0 auto"},fabProgress:{position:"absolute",zIndex:1,top:-34,left:0,right:0,margin:"0 auto",color:e.palette.color.main},hide:{display:"none"}}})(function(e){var t=e.classes,a=Object(n.createRef)(),o=Object(n.useState)(0),i=Object(h.a)(o,2),c=i[0],u=i[1],l=r.a.useState(!1),s=Object(h.a)(l,2),d=s[0],p=s[1],f=Object(g.c)(function(e){return e.user}),m=Object(g.c)(function(e){return e.latestValidPost}).latestValidPost;Object(n.useEffect)(function(){u(m?function(e){var t=100-((new Date).getTime()/1e3-e.getTime()/1e3)/86400*100;return t<0?0:t>100?100:t}(m.timestamp.toDate()):0)},[m]);function v(e,t){"clickaway"!==t&&p(!1)}return r.a.createElement("div",null,r.a.createElement("span",{className:t.hide},r.a.createElement("input",{type:"file",accept:"image/*",onChange:function(t){return e.handleFile(t)},ref:a})),r.a.createElement(ze.a,{"aria-label":"Add",className:t.fabButton,size:"large",onClick:function(){f.authenticated?a.current.click():p(!0)}},r.a.createElement(x.a,null,"photo_camera")),r.a.createElement(te.a,{size:66,variant:e.showUploadLoader?"indeterminate":"static",value:c,className:t.fabProgress}),r.a.createElement(Ne.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},message:r.a.createElement("span",{id:"message-id"},"Login to post pictures"),open:d,autoHideDuration:1e4,onClose:v,action:r.a.createElement(y.a,{key:"close","aria-label":"Close",color:"inherit",className:t.close,onClick:v},r.a.createElement(x.a,null,"close"))}))}),Me=a(83),Ge=a.n(Me),He=function(e){var t=Object(g.c)(function(e){return e.triedLogin}),a={signInFlow:"popup",signInOptions:[R.auth.FacebookAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}};return r.a.createElement("div",null,t?r.a.createElement(Ge.a,{uiConfig:a,firebaseAuth:R.auth()}):r.a.createElement(O.a,{variant:"subtitle1",style:{textAlign:"center"}},"authenticating"))},qe=Object(v.a)(function(e){return{App:{minHeight:"100vh",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"800px",width:"100%"}}}),Je=function(e){var t=Object(n.useState)(!1),a=Object(h.a)(t,2),o=a[0],i=a[1],c=Object(n.useState)(""),u=Object(h.a)(c,2),l=u[0],s=u[1],d=Object(n.useState)(!1),p=Object(h.a)(d,2),f=p[0],m=p[1],v=Object(n.useState)(0),b=Object(h.a)(v,2),E=b[0],w=b[1],O=qe(),y=Object(g.c)(function(e){return e.user}),x=Object(g.c)(function(e){return e.groups}),j=Object(g.c)(function(e){return e.latestValidPost}).latestValidPost,S=Object(g.b)(),k=function(e){return function(){i(e)}};Object(n.useEffect)(function(){var t,a;y.authenticated&&e.FCMToken&&(t=e.FCMToken,a=y.data.uid,I.collection("users").doc(a).update({FCMToken:t}))},[y,e.FCMToken]),Object(n.useEffect)(function(){var e=new URL(window.location.href).searchParams.get("groupId");e&&y.authenticated&&(window.history.pushState({},"","/paiweb"),function(e,t){I.collection("groups").doc(e).update({uidList:R.firestore.FieldValue.arrayUnion(t.uid),members:R.firestore.FieldValue.arrayUnion({uid:t.uid,photoURL:t.photoURL,displayName:t.displayName})})}(e,y.data))},[y,y.authenticated]);var T=function(e){return e.map(function(e){return e.id})},C=function(){m(!1),w(E+1),X(y.data.uid).then(function(e){S(A(e)),S(W(!0))})};return r.a.createElement("div",{className:O.App},r.a.createElement(B,null),y.authenticated?r.a.createElement(n.Fragment,null,r.a.createElement(_e,{open:o,toggleDrawer:k}),r.a.createElement(Te,{imagePreviewUrl:l,updateFeed:E})):r.a.createElement(He,null),r.a.createElement(F,{toggleDrawer:k,camera:r.a.createElement(Ve,{showUploadLoader:f,handleFile:function(e){var t=e.target.files[0];if(t||!y.authenticated){m(!0);var a=T(x);!function(e,t){e&&new V.a(e,{quality:.7,width:512,success:function(e){t(e)},error:function(e){console.log(e.message)}})}(t,function(e){s(URL.createObjectURL(e)),H(e,y.data,a,C)})}},latestValidPost:j})}))},Ye=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ke(e){if("serviceWorker"in navigator){if(new URL("/paiweb",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/paiweb","/service-worker.js");Ye?(!function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Xe(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Xe(t,e)})}}function Xe(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var $e=function(e){return r.a.createElement("div",null,r.a.createElement(Ne.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:e.showUpdateSnackBar,onClose:e.handleCloseSnackBar,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},"New Update! Restart the app")}))};var Ze=a(41),Qe=[],et={authenticated:!1,data:{}},tt={allPosts:[],loading:!1},at={latestValidPost:null,gotLatestPost:!1},nt=Object(Ze.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":var a=t.payload.user;return Object(_.a)({},e,{authenticated:!!a,data:a});case"LOGOUT":return Object(_.a)({},e,{authenticated:!1,data:{}});default:return e}},groups:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GROUPS":return t.payload.groups;default:return e}},feed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POSTS":var a=t.payload.allPosts;return Object(_.a)({},e,{allPosts:a});case"SET_LOADING":var n=t.payload.loading;return Object(_.a)({},e,{loading:n});default:return e}},triedLogin:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TRIED_lOGIN":return t.payload;default:return e}},latestValidPost:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LATEST_VALID_POST":return Object(_.a)({},e,{latestValidPost:t.payload});case"SET_GOT_LATEST_VALID_POST":return Object(_.a)({},e,{gotLatestPost:t.payload});default:return e}}}),rt=Object(Ze.c)(nt),ot=function(){C.a.auth().onAuthStateChanged(function(e){C.a.auth().setPersistence(C.a.auth.Auth.Persistence.LOCAL),rt.dispatch(function(e){return{type:"SET_USER",payload:{user:e}}}(e)),ct(e),lt(e),e||rt.dispatch({type:"TRIED_lOGIN",payload:!0})})},it=null,ct=function(e){var t;e&&(t=e.uid,I.collection("groups").where("uidList","array-contains",t).get().then(function(e){var t=[];return e.forEach(function(e){var a=e.data();a.id=e.id,t.push(a)}),t})).then(function(e){rt.dispatch(function(e){return{type:"SET_GROUPS",payload:{groups:e}}}(e)),it=e,st()})},ut=null,lt=function(e){X(e.uid).then(function(e){rt.dispatch(A(e)),ut=e,rt.dispatch(W(!0)),st()})},st=function(){if(it&&ut){rt.dispatch(U(!0));var e=it.map(function(e){return e.id});K(e).then(function(e){rt.dispatch(L(e,!0)),rt.dispatch(U(!1))})}};ot();var dt=null;C.a.messaging.isSupported()&&(dt=C.a.messaging());var pt=Object(p.a)({palette:{type:"dark",background:{main:"#000000"},primary:{main:"#000000"},secondary:{main:"#ffffff"},color:{main:"#FF2188"},gray:{main:"#666666"}},typography:{useNextVariants:!0}}),ft=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleServiceWorkerUpdate=function(e){a.setState({showUpdateSnackBar:!0})},a.handleCloseSnackBar=function(e,t){"clickaway"!==t&&a.setState({showUpdateSnackBar:!1})},a.state={showUpdateSnackBar:!1,FCMToken:""},"serviceWorker"in navigator&&dt&&navigator.serviceWorker.register("./fbsw/firebase-messaging-sw.js").then(function(e){dt.useServiceWorker(e),function(e){return e.requestPermission().then(function(){return e.getToken()})}(dt).then(function(e){a.setState({FCMToken:e})}).catch(function(e){"messaging/permission-blocked"===e.code?console.log("Please Unblock Notification Request Manually"):console.log("Error Occurred",e)})}).catch(function(e){console.log("Service worker registration failed, error:",e)}),Ke({onUpdate:a.handleServiceWorkerUpdate}),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(f.a,{theme:pt},r.a.createElement(m.a,null),r.a.createElement(g.a,{store:rt},r.a.createElement(Je,{FCMToken:this.state.FCMToken})),r.a.createElement($e,{handleCloseSnackBar:this.handleCloseSnackBar,showUpdateSnackBar:this.state.showUpdateSnackBar}))}}]),t}(n.Component);i.a.render(r.a.createElement(ft,null),document.getElementById("root"))},96:function(e,t,a){e.exports=a(126)}},[[96,1,2]]]);
//# sourceMappingURL=main.1b141036.chunk.js.map