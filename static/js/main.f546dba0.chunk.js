(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(7),c=n.n(o),i=(n(101),n(72)),u=n(73),l=n(86),s=n(74),d=n(87),f=n(84),p=n(176),m=n(171),h=n(12),g=n(9),b=n(134),v=n(135),E=n(157),w=n(158),O=n(159),y=n(160),j=n(163),x=n(162),k=n(166),S=n(175),T=n(22),C=n.n(T),R=(n(108),n(70),n(127),n(128),{apiKey:"AIzaSyCNrWqbvDNEp53wNfDtDMqfZbgStsJEM-E",authDomain:"paiweb.firebaseapp.com",databaseURL:"https://paiweb.firebaseio.com",projectId:"paiweb",storageBucket:"paiweb.appspot.com",messagingSenderId:"560094021764",appId:"1:560094021764:web:d9efaf85f4747eb1"}),D={apiKey:R.apiKey,authDomain:R.authDomain,databaseURL:R.databaseUrl,projectId:R.projectId,storageBucket:R.storageBucket,messagingSenderId:R.messagingSenderId,appId:R.appId};C.a.initializeApp(D),C.a.firestore().enablePersistence().catch(function(e){"failed-precondition"===e.code?console.log(e.code):"unimplemented"===e.code&&console.log(e.code)});var N=C.a,P=C.a.firestore(),I=function(){return{type:"LOGOUT",payload:{}}},L=function(){return{type:"SET_POSTS",payload:{allPosts:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}},U=function(e){return{type:"SET_LATEST_VALID_POST",payload:e}},A=function(e){return{type:"SET_GOT_LATEST_VALID_POST",payload:e}},B=Object(v.a)({root:{},grow:{flexGrow:1},avatar:{margin:0,padding:0,height:"24px",width:"24px"}})(function(e){var t=e.classes,n=r.a.useState(null),a=Object(h.a)(n,2),o=a[0],c=a[1],i=Boolean(o),u=Object(g.c)(function(e){return e.user}),l=Object(g.b)();return r.a.createElement("div",{className:t.root},r.a.createElement(E.a,{position:"static"},r.a.createElement(w.a,null,r.a.createElement(O.a,{variant:"h6",color:"inherit",className:t.grow},"Pai"),r.a.createElement(y.a,{color:"inherit",onClick:function(e){u.authenticated&&c(e.currentTarget)}},u.authenticated?r.a.createElement(x.a,{alt:"Remy Sharp",src:u.data.photoURL,className:t.avatar}):r.a.createElement(j.a,null,"account_circle")),r.a.createElement(S.a,{id:"menu-appbar",anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:i,onClose:function(){c(null)}},r.a.createElement(k.a,{onClick:function(){c(null),N.auth().signOut(),l(I())}},"Sign out")))))}),W=Object(v.a)(function(e){return{appBar:{top:"auto",bottom:0},toolbar:{alignItems:"center",justifyContent:"space-between"}}})(function(e){var t=e.classes;return r.a.createElement(E.a,{position:"sticky",color:"primary",className:t.appBar},r.a.createElement(w.a,{className:t.toolbar,variant:"dense"},r.a.createElement(y.a,{color:"inherit","aria-label":"Open drawer",onClick:e.toggleDrawer(!0)},r.a.createElement(j.a,null,"menu")),e.camera))}),F=n(30),_=(n(63),n(79),n(54)),z=n(80),V=function(e){var t=((new Date).getTime()-e.getTime())/1e3;return t<60?parseInt(t)+"s":t<3600?parseInt(t/60)+"m":t<=172800?parseInt(t/3600)+"h":t>172800?"< 2 days":void 0},M=function(e){var t=100-((new Date).getTime()/1e3-e.getTime()/1e3)/172800*100;return t<0?0:t>100?100:t},G=function(e,t,n,a){var r="images/"+t.uid+"/"+function(e){return Date.now()+e.name.substr(e.name.lastIndexOf("."))}(e);N.storage().ref(r).put(e,{cacheControl:"max-age=432001",contentType:e.type}).on("state_changed",function(e){},function(e){console.log("ERROR!",e)},function(){H(r,t,n,a)})},H=function(e,t,n,a){var r=P.batch();n.forEach(function(n){var a=P.collection("posts").doc();r.set(a,{uid:t.uid,userPhotoURL:t.photoURL,imgRef:e,timestamp:N.firestore.FieldValue.serverTimestamp(),groupId:n})}),r.commit().then(function(e){J(t.uid).then(function(){a()})}).catch(function(e){console.error("Error adding document: ",e)})},q=function(e,t,n){P.collection("posts").doc(t).update(Object(_.a)({},"canvasDrawings.".concat(n),e))},J=function(e){return P.collection("users").doc(e).update({lastUpdate:N.firestore.FieldValue.serverTimestamp()})},Y=function(e){return P.collection("posts").where("timestamp",">",new Date(Date.now()-1728e5)).where("groupId","in",e).orderBy("timestamp","desc").limit(50).get().then(function(e){var t=[];return e.forEach(function(e){t.push(Object(F.a)({},e.data(),{postId:e.id}))}),t})},K=function(e){return P.collection("posts").where("timestamp",">",new Date(new Date-864e5)).where("uid","==",e).orderBy("timestamp","desc").limit(1).get().then(function(e){var t;return e.forEach(function(e){t=e.data()}),t})},X=n(81),$=n.n(X),Z=n(82),Q=n.n(Z),ee=n(167),te=n(85),ne=Object(b.a)(function(e){return{icon:{position:"absolute",bottom:"-16px",right:"50px"}}}),ae=function(e){var t=e.undo,n=e.drawEnabled,o=ne();return r.a.createElement(a.Fragment,null,n?r.a.createElement(j.a,{fontSize:"large",className:o.icon,onClick:t,color:"secondary"},"undo"):"")},re=Object(b.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"},touchActionNone:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00",touchAction:"none"}}}),oe=function(e){var t=re(),n=Object(g.c)(function(e){return e.user.data.uid}),o=e.canvasDrawing,i=e.imageWrapperRef,u=e.postId,l=e.drawEnabled,s=Object(a.useRef)(),d=Object(a.useRef)([]),f=!1,p=Object(a.useRef)(),m=Object(a.useRef)(),h=Object(a.useCallback)(function(e,t){var n=s.current.getContext("2d");d.current.push({x:e,y:t}),n.beginPath(),n.strokeStyle="red",n.lineWidth=4,n.lineJoin="round",n.moveTo(p.current,m.current),n.lineTo(e,t),n.stroke(),n.closePath(),p.current=e,m.current=t},[]),b=Object(a.useCallback)(function(){p.current=void 0,m.current=void 0},[]);Object(a.useEffect)(function(){var e=new ResizeObserver(function(e){v(),o&&s.current?(d.current=[],b(),s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height),o.forEach(function(e){"up"===e?(d.current.push("up"),b()):h(e.x,e.y)})):s.current&&(d.current=[],s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height))});return e.observe(i.current),function(){try{e.disconnect()}catch(t){console.log("error",t)}}},[i,o,h,b]);var v=function(){s.current&&(s.current.style.width="100%",s.current.style.height="100%",s.current.width=s.current.offsetWidth,s.current.height=s.current.offsetHeight)},E=function(e,t){l&&("down"===e&&O(t),"move"===e&&y(t),"up"===e&&S(t))},w=function(){s.current.getContext("2d").clearRect(0,0,s.current.width,s.current.height);var e=Object(te.a)(d.current);d.current=[],b(),e.forEach(function(e){"up"===e?(d.current.push("up"),b()):h(e.x,e.y)}),q(d.current,u,n)},O=function(e){f=!0},y=function(e){e.preventDefault();var t=function(e){var t=c.a.findDOMNode(s.current).getBoundingClientRect(),n=e.clientX,a=e.clientY;return e.changedTouches&&e.changedTouches.length>0&&(n=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY),{x:n-t.left,y:a-t.top}}(e),n=t.x,a=t.y;j(n,a)&&h(n,a)},j=function(e,t){return!(!f||!x(e,t))},x=function(e,t){return!m.current||!m.current||!(!k(e,p.current)&&!k(t,m.current))||void 0},k=function(e,t){return e-t>2||t-e>2},S=function(e){f&&"up"!==d.current[d.current.length-1]&&(d.current.push("up"),b(),q(d.current,u,n)),f=!1};return r.a.createElement(a.Fragment,null,r.a.createElement("canvas",{className:l?t.touchActionNone:t.canvas,onMouseDown:function(e){return E("down",e)},onTouchStart:function(e){return E("down",e)},onMouseMove:function(e){return E("move",e)},onTouchMove:function(e){return E("move",e)},onMouseUp:function(e){return E("up",e)},onTouchEnd:function(e){return E("up",e)},onMouseOut:function(e){return E("up",e)},onTouchCancel:function(e){return E("up",e)},ref:s}),r.a.createElement(ae,{undo:function(){if(d.current&&d.current.length){var e=d.current,t=e.lastIndexOf("up",e.length-2)+1;d.current=e.slice(0,t),w()}},drawEnabled:l}))},ce=Object(b.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"}}}),ie=function(e){var t=e.canvasDrawings,n=e.imageWrapperRef,o=Object(a.useRef)(),c=ce(),i=Object(a.useRef)(),u=Object(a.useRef)(),l=Object(a.useCallback)(function(e,t){var n=o.current.getContext("2d");n.beginPath(),n.strokeStyle="red",n.lineWidth=4,n.lineJoin="round",n.moveTo(i.current,u.current),n.lineTo(e,t),n.stroke(),n.closePath(),i.current=e,u.current=t},[]),s=Object(a.useCallback)(function(){i.current=void 0,u.current=void 0},[]);Object(a.useEffect)(function(){new ResizeObserver(function(e){d(),function(){if(t&&o.current){s();var e=o.current.getContext("2d");for(var n in e.clearRect(0,0,o.width,o.height),t)t[n].forEach(function(e){"up"===e?s():l(e.x,e.y)})}}()}).observe(n.current)},[n,l,t,s]);var d=function(){o.current&&(o.current.style.width="100%",o.current.style.height="100%",o.current.width=o.current.offsetWidth,o.current.height=o.current.offsetHeight)};return r.a.createElement("canvas",{className:c.canvas,ref:o})},ue=Object(b.a)(function(e){return{imgDiv:{borderRadius:"4px",minHeight:"75vh",maxHeight:"75vh",maxWidth:"450px",overflow:"hidden",position:"relative"},img:{position:"absolute",top:"0",bottom:"0",margin:"auto",borderRadius:"4px",boxShadow:"0px 1px 3px 0px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 2px 1px -1px rgba(0,0,0,0.12)"},progressWrapper:{widh:"100%",height:"75vh",display:"flex",justifyContent:"center",alignItems:"center"},progress:{color:e.palette.color.main}}}),le=function(e){var t=Object(a.useState)(""),n=Object(h.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)(!1),u=Object(h.a)(i,2),l=u[0],s=u[1],d=Object(a.useRef)(),f=ue(),p=Object(g.c)(function(e){return e.user.data.uid}),m=e.imageRef,b=e.drawEnabled,v=e.postId,E=e.canvasDrawings;Object(a.useEffect)(function(){return w(m)},[m]);var w=function(e){(function(e){if(e)return N.storage().ref(e).getDownloadURL().then(function(e){return e})})(e).then(function(e){return c(e)})};return r.a.createElement(Q.a,{onChange:function(e){s(e)},active:!l,offset:{top:100},partialVisibility:!0},r.a.createElement("div",{className:f.imgDiv,ref:d},l&&r.a.createElement(r.a.Fragment,null,r.a.createElement($.a,{width:"100%",height:"auto",src:o,alt:"image post",className:f.img,loader:r.a.createElement("div",{className:f.progressWrapper},r.a.createElement(ee.a,{className:f.progress}))}),r.a.createElement(ie,{canvasDrawings:function(){if(E){var e=Object.assign({},E);return delete e[p],e}}(),imageWrapperRef:d}),r.a.createElement(oe,{drawEnabled:b,imageWrapperRef:d,postId:v,canvasDrawing:E&&E[p]}))))},se=n(133),de=Object(se.a)(function(e){return{timeText:{textShadow:"0px 0px 6px #333030"},progress:{marginLeft:"5px",color:e.palette.color.main,zIndex:2},innerProgress:{position:"relative",marginLeft:"-16px",color:e.palette.gray.main,zIndex:1}}}),fe=function(e){var t=de(),n=e.timestamp;return r.a.createElement(a.Fragment,null,r.a.createElement(O.a,{variant:"caption",className:t.timeText},V(n.toDate())),r.a.createElement(ee.a,{color:"primary",variant:"static",value:M(n.toDate()),className:t.progress,size:16}),r.a.createElement(ee.a,{variant:"static",value:100,className:t.innerProgress,size:16}))},pe=Object(b.a)(function(e){return{icon:{position:"absolute",bottom:"-16px",right:"8px"}}}),me=function(e){var t=e.editDrawEnabled,n=e.drawEnabled,a=pe();return r.a.createElement(j.a,{fontSize:"large",className:a.icon,onClick:t,color:n?"secondary":"disabled"},"brush")},he=Object(b.a)(function(e){return{root:{scrollSnapAlign:"start",padding:"0px",paddingBottom:"24px",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},postWrapper:{position:"relative",width:"100%",maxWidth:"450px"},avatar:{border:"2px solid #fafafa",marginRight:"8px"},avatarTimeDiv:{position:"absolute",zIndex:2,display:"flex",padding:"8px",alignItems:"center"}}}),ge=function(e){var t=he(),n=Object(a.useState)(!1),o=Object(h.a)(n,2),c=o[0],i=o[1],u=e.post;return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.postWrapper},r.a.createElement("div",{className:t.avatarTimeDiv},r.a.createElement(x.a,{className:t.avatar,alt:"Post Avatar",src:u.userPhotoURL}),r.a.createElement(fe,{timestamp:u.timestamp})),r.a.createElement(le,{drawEnabled:c,imageRef:u.imgRef,canvasDrawings:u.canvasDrawings,postId:u.postId}),r.a.createElement(me,{editDrawEnabled:function(){i(!c)},drawEnabled:c})))},be=Object(b.a)(function(e){return{root:{padding:"0px",minHeight:"78vh",height:"78vh",display:"flex",flexDirection:"column",justifyContent:"space-around",textAlign:"center",alignItems:"center"},"@keyframes arrowAnimation":{from:{transform:"translateY(0)"},to:{transform:"translateY(30px)"}},icon:{position:"relative",fontSize:"65px",animation:"$arrowAnimation 2s infinite alternate"}}}),ve=function(){var e=be();return r.a.createElement("div",{className:e.root},r.a.createElement("div",null),r.a.createElement("span",null,r.a.createElement(O.a,{align:"center",variant:"h4"},"Show friends what you are up to.",r.a.createElement("br",null)," Post a picture.")),r.a.createElement(j.a,{color:"disabled",className:e.icon,fontSize:"large"},"arrow_downward"))},Ee=n(132),we=function(e){var t=Oe();return e.members.map(function(e,n){return r.a.createElement(x.a,{key:"key"+n,alt:"Avatar photo",src:e.photoURL,className:t.avatar})})},Oe=Object(b.a)(function(e){return{groupWrapper:{display:"flex",width:"100%",scrollSnapAlign:"start"},avatar:{marginLeft:"-6px",border:"2px solid white"},listItemWrapper:{display:"flex"},leftAvatarsLine:{width:"100%",borderTop:"1px solid white",marginLeft:"8px",marginTop:"35px",height:"16px"},rightAvatarsLine:{width:"100%",borderTop:"1px solid white",marginRight:"8px",marginTop:"35px",height:"16px"}}}),ye=function(e){var t=e.group,n=Oe();return r.a.createElement("div",{className:n.groupWrapper},r.a.createElement("div",{className:n.leftAvatarsLine}),r.a.createElement("div",{className:n.listItemWrapper},r.a.createElement(Ee.a,null,we(t))),r.a.createElement("div",{className:n.rightAvatarsLine}))},je=Object(b.a)(function(e){return{feedWrapper:{flexDirection:"column",overflowY:"scroll",scrollSnapType:"y mandatory",backgroundColor:e.palette.background.main},feedTopDiv:{scrollSnapAlign:"end"}}}),xe=function(e){var t=Object(a.useState)(!0),n=Object(h.a)(t,2),o=n[0],c=n[1],i=je(),u=Object(g.c)(function(e){return e.user}),l=Object(g.c)(function(e){return e.feed}),s=Object(g.c)(function(e){return e.groups}),d=Object(g.c)(function(e){return e.latestValidPost}),f=d.latestValidPost,p=d.gotLatestPost,m=Object(g.b)();Object(a.useEffect)(function(){p&&s&&s.length&&c(!!f)},[f,p,m,s]),Object(a.useEffect)(function(){if(e.updateFeed&&s&&s.length){var t=s.map(function(e){return e.id});Y(t).then(function(e){return m(L(e))}),c(!0)}},[e.updateFeed,u,m,s]);var b=function(e,t){return r.a.createElement(a.Fragment,{key:"key"+t},r.a.createElement(ye,{group:e}),v(e.id))},v=function(e){return l.allPosts.filter(function(t){return t.groupId===e}).map(function(e,t){return r.a.createElement(ge,{key:"post"+t,post:e})})};return r.a.createElement("div",{className:i.feedWrapper},r.a.createElement("div",{className:i.feedTopDiv}),o?s.map(function(e,t){return b(e,t)}):r.a.createElement(ve,null))},ke=n(173),Se=n(174),Te=n(168);function Ce(e){return r.a.createElement(Te.a,Object.assign({},e,{direction:"right"}))}var Re=function(e){return r.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:1300,open:e.showSnackBar,onClose:e.handleCloseSnackBar,TransitionComponent:Ce,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},e.snackBarText),action:[r.a.createElement(y.a,{key:"close","aria-label":"close",color:"inherit",onClose:e.handleCloseSnackBar},r.a.createElement(j.a,null,"close"))]})},De=n(169),Ne=function(){var e=Object(g.c)(function(e){return e.user});return r.a.createElement(a.Fragment,null,"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===e.data.uid?r.a.createElement(De.a,{color:"secondary",onClick:function(){e.authenticated&&e.data&&function(e){P.collection("groups").add({uidList:[e.uid],members:[{uid:e.uid,photoURL:e.photoURL,displayName:e.displayName}]})}(e.data)}},"Create Group ",r.a.createElement(j.a,null,"add")):"")},Pe=n(165),Ie=function(e,t){if(e&&t){var n=t.filter(function(t){return t.uid===e}).sort(function(e,t){return e.timestamp.toDate().getTime()-t.timestamp.toDate().getTime()});return n[0]?V(n[n.length-1].timestamp.toDate()):"\ud83d\ude34"}},Le=Object(b.a)(function(e){return{loadingText:{marginLeft:"16px"},avatar:{marginLeft:"-6px",border:"2px solid white"},groupButtonWrapper:{display:"flex",alignItems:"center"},timer:{margin:0}}}),Ue=function(e){var t=Le(),n=Object(g.c)(function(e){return e.groups}),o=Object(g.c)(function(e){return e.user}),c=Object(g.c)(function(e){return e.feed}).allPosts,i=Object(a.useState)(),u=Object(h.a)(i,2),l=u[0],s=u[1],d=function(e,n){return r.a.createElement("div",{key:"key"+n,className:t.groupButtonWrapper},r.a.createElement(Ee.a,null,f(e)),"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===o.data.uid?r.a.createElement(y.a,{onClick:function(){return p(e.id)}},r.a.createElement(j.a,null,"group_add")):"")},f=function(e){return e.members.map(function(e,n){return r.a.createElement("div",{key:"avatar"+n},r.a.createElement(x.a,{onClick:function(){return m(e)},key:"key"+n,alt:"Avatar photo",src:e.photoURL,className:t.avatar}),r.a.createElement("p",{className:t.timer},Ie(e.uid,c)))})},p=function(e){var t=window.location.href+"?groupId="+e;s(t),navigator.clipboard.writeText(t).then(function(){},function(e){console.error("Async: Could not copy text: ",e)})},m=function(t){e.setShowSnackBar(!0,"Notification to "+t.displayName),function(e){var t=N.functions().httpsCallable("sendPushNotificationTest");return t({toUid:e})}(t.uid).then(function(t){var n=t.data?"Sent Notification!":"Couldn't send notification";e.setShowSnackBar(!0,n)})};return r.a.createElement(Pe.a,null,n?r.a.createElement(r.a.Fragment,null,n.map(function(e,t){return d(e,t)}),r.a.createElement(O.a,{variant:"body2",color:"inherit",className:t.loadingText},l)):r.a.createElement(O.a,{variant:"body2",color:"inherit",className:t.loadingText},"loading groups.."))},Ae=Object(b.a)(function(e){return{drawerList:{height:"100%",width:"250px",display:"flex",paddingTop:"8px",flexDirection:"column",justifyContent:"space-between",backgroundColor:e.palette.background.main}}}),Be=function(e){var t=e.open,n=e.toggleDrawer,o=Ae(),c=Object(a.useState)(!1),i=Object(h.a)(c,2),u=i[0],l=i[1],s=Object(a.useState)("Push Notification"),d=Object(h.a)(s,2),f=d[0],p=d[1];return r.a.createElement(a.Fragment,null,r.a.createElement(Re,{handleCloseSnackBar:function(){l(!1)},showSnackBar:u,snackBarText:f}),r.a.createElement(ke.a,{open:t,onClose:n(!1),onOpen:n(!0)},r.a.createElement("div",{className:o.drawerList},r.a.createElement(Ue,{setShowSnackBar:function(e,t){l(e),p(t)}}),r.a.createElement(Ne,null),r.a.createElement(O.a,{variant:"body2",gutterBottom:!0},"Beta v.0.2.1"))))},We=n(170),Fe=Object(v.a)(function(e){return{fabButton:{position:"absolute",zIndex:2,top:"-29px",left:0,right:0,margin:"0 auto"},fabProgress:{position:"absolute",zIndex:1,top:-34,left:0,right:0,margin:"0 auto",color:e.palette.color.main},hide:{display:"none"}}})(function(e){var t=e.classes,n=Object(a.createRef)(),o=Object(a.useState)(0),c=Object(h.a)(o,2),i=c[0],u=c[1],l=r.a.useState(!1),s=Object(h.a)(l,2),d=s[0],f=s[1],p=Object(g.c)(function(e){return e.user}),m=Object(g.c)(function(e){return e.latestValidPost}).latestValidPost;Object(a.useEffect)(function(){u(m?function(e){var t=100-((new Date).getTime()/1e3-e.getTime()/1e3)/86400*100;return t<0?0:t>100?100:t}(m.timestamp.toDate()):0)},[m]);function b(e,t){"clickaway"!==t&&f(!1)}return r.a.createElement("div",null,r.a.createElement("span",{className:t.hide},r.a.createElement("input",{type:"file",accept:"image/*",capture:!0,onChange:function(t){return e.handleFile(t)},ref:n})),r.a.createElement(We.a,{"aria-label":"Add",className:t.fabButton,size:"large",onClick:function(){p.authenticated?n.current.click():f(!0)}},r.a.createElement(j.a,null,"photo_camera")),r.a.createElement(ee.a,{size:66,variant:e.showUploadLoader?"indeterminate":"static",value:i,className:t.fabProgress}),r.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},message:r.a.createElement("span",{id:"message-id"},"Login to post pictures"),open:d,autoHideDuration:1e4,onClose:b,action:r.a.createElement(y.a,{key:"close","aria-label":"Close",color:"inherit",className:t.close,onClick:b},r.a.createElement(j.a,null,"close"))}))}),_e=n(83),ze=n.n(_e),Ve=function(e){var t=Object(g.c)(function(e){return e.triedLogin}),n={signInFlow:"popup",signInOptions:[N.auth.FacebookAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}};return r.a.createElement("div",null,t?r.a.createElement(ze.a,{uiConfig:n,firebaseAuth:N.auth()}):r.a.createElement(O.a,{variant:"subtitle1",style:{textAlign:"center"}},"authenticating"))},Me=Object(b.a)(function(e){return{App:{minHeight:"100vh",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"800px",width:"100%"}}}),Ge=function(e){var t=Object(a.useState)(!1),n=Object(h.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)(""),u=Object(h.a)(i,2),l=u[0],s=u[1],d=Object(a.useState)(!1),f=Object(h.a)(d,2),p=f[0],m=f[1],b=Object(a.useState)(0),v=Object(h.a)(b,2),E=v[0],w=v[1],O=Me(),y=Object(g.c)(function(e){return e.user}),j=Object(g.c)(function(e){return e.groups}),x=Object(g.c)(function(e){return e.latestValidPost}).latestValidPost,k=Object(g.b)(),S=function(e){return function(){c(e)}};Object(a.useEffect)(function(){var t,n;y.authenticated&&e.FCMToken&&(t=e.FCMToken,n=y.data.uid,P.collection("users").doc(n).update({FCMToken:t}))},[y,e.FCMToken]),Object(a.useEffect)(function(){var e=new URL(window.location.href).searchParams.get("groupId");e&&y.authenticated&&(window.history.pushState({},"","/paiweb"),function(e,t){P.collection("groups").doc(e).update({uidList:N.firestore.FieldValue.arrayUnion(t.uid),members:N.firestore.FieldValue.arrayUnion({uid:t.uid,photoURL:t.photoURL,displayName:t.displayName})})}(e,y.data))},[y,y.authenticated]);var T=function(e){return e.map(function(e){return e.id})},C=function(){m(!1),w(E+1),K(y.data.uid).then(function(e){k(U(e)),k(A(!0))})};return r.a.createElement("div",{className:O.App},r.a.createElement(B,null),y.authenticated?r.a.createElement(a.Fragment,null,r.a.createElement(Be,{open:o,toggleDrawer:S}),r.a.createElement(xe,{imagePreviewUrl:l,updateFeed:E})):r.a.createElement(Ve,null),r.a.createElement(W,{toggleDrawer:S,camera:r.a.createElement(Fe,{showUploadLoader:p,handleFile:function(e){var t=e.target.files[0];if(t||!y.authenticated){m(!0);var n=T(j);!function(e,t){e&&new z.a(e,{quality:.7,width:512,success:function(e){t(e)},error:function(e){console.log(e.message)}})}(t,function(e){s(URL.createObjectURL(e)),G(e,y.data,n,C)})}},latestValidPost:x})}))},He=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function qe(e){if("serviceWorker"in navigator){if(new URL("/paiweb",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/paiweb","/service-worker.js");He?(!function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Je(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Je(t,e)})}}function Je(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var Ye=function(e){return r.a.createElement("div",null,r.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:e.showUpdateSnackBar,onClose:e.handleCloseSnackBar,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},"New Update! Restart the app")}))};var Ke=n(41),Xe=[],$e={authenticated:!1,data:{}},Ze={allPosts:[]},Qe={latestValidPost:null,gotLatestPost:!1},et=Object(Ke.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$e,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":var n=t.payload.user;return Object(F.a)({},e,{authenticated:!!n,data:n});case"LOGOUT":return Object(F.a)({},e,{authenticated:!1,data:{}});default:return e}},groups:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GROUPS":return t.payload.groups;default:return e}},feed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POSTS":var n=t.payload.allPosts;return Object(F.a)({},e,{allPosts:n});default:return e}},triedLogin:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TRIED_lOGIN":return t.payload;default:return e}},latestValidPost:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LATEST_VALID_POST":return Object(F.a)({},e,{latestValidPost:t.payload});case"SET_GOT_LATEST_VALID_POST":return Object(F.a)({},e,{gotLatestPost:t.payload});default:return e}}}),tt=Object(Ke.c)(et),nt=function(){C.a.auth().onAuthStateChanged(function(e){C.a.auth().setPersistence(C.a.auth.Auth.Persistence.LOCAL),tt.dispatch(function(e){return{type:"SET_USER",payload:{user:e}}}(e)),rt(e),ct(e),e||tt.dispatch({type:"TRIED_lOGIN",payload:!0})})},at=null,rt=function(e){var t;e&&(t=e.uid,P.collection("groups").where("uidList","array-contains",t).get().then(function(e){var t=[];return e.forEach(function(e){var n=e.data();n.id=e.id,t.push(n)}),t})).then(function(e){tt.dispatch(function(e){return{type:"SET_GROUPS",payload:{groups:e}}}(e)),at=e,it()})},ot=null,ct=function(e){K(e.uid).then(function(e){tt.dispatch(U(e)),ot=e,tt.dispatch(A(!0)),it()})},it=function(){if(at&&ot){var e=at.map(function(e){return e.id});Y(e).then(function(e){tt.dispatch(L(e))})}};nt();var ut=null;C.a.messaging.isSupported()&&(ut=C.a.messaging());var lt=Object(f.a)({palette:{type:"dark",background:{main:"#000000"},primary:{main:"#000000"},secondary:{main:"#ffffff"},color:{main:"#FF2188"},gray:{main:"#666666"}},typography:{useNextVariants:!0}}),st=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleServiceWorkerUpdate=function(e){n.setState({showUpdateSnackBar:!0})},n.handleCloseSnackBar=function(e,t){"clickaway"!==t&&n.setState({showUpdateSnackBar:!1})},n.state={showUpdateSnackBar:!1,FCMToken:""},"serviceWorker"in navigator&&ut&&navigator.serviceWorker.register("./fbsw/firebase-messaging-sw.js").then(function(e){ut.useServiceWorker(e),function(e){return e.requestPermission().then(function(){return e.getToken()})}(ut).then(function(e){n.setState({FCMToken:e})}).catch(function(e){"messaging/permission-blocked"===e.code?console.log("Please Unblock Notification Request Manually"):console.log("Error Occurred",e)})}).catch(function(e){console.log("Service worker registration failed, error:",e)}),qe({onUpdate:n.handleServiceWorkerUpdate}),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,{theme:lt},r.a.createElement(m.a,null),r.a.createElement(g.a,{store:tt},r.a.createElement(Ge,{FCMToken:this.state.FCMToken})),r.a.createElement(Ye,{handleCloseSnackBar:this.handleCloseSnackBar,showUpdateSnackBar:this.state.showUpdateSnackBar}))}}]),t}(a.Component);c.a.render(r.a.createElement(st,null),document.getElementById("root"))},96:function(e,t,n){e.exports=n(126)}},[[96,1,2]]]);
//# sourceMappingURL=main.f546dba0.chunk.js.map