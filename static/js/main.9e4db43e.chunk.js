(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,n){e.exports=n(138)},106:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(7),i=n.n(o),c=(n(106),n(76)),u=n(77),s=n(91),l=n(78),d=n(92),f=n(90),p=n(187),m=n(182),h=n(12),g=n(10),b=n(145),v=n(146),E=n(168),w=n(169),O=n(170),j=n(171),y=n(174),x=n(173),k=n(177),S=n(186),C=n(44),N=n.n(C),T=(n(113),n(71),n(116),n(117),{apiKey:"AIzaSyCNrWqbvDNEp53wNfDtDMqfZbgStsJEM-E",authDomain:"paiweb.firebaseapp.com",databaseURL:"https://paiweb.firebaseio.com",projectId:"paiweb",storageBucket:"paiweb.appspot.com",messagingSenderId:"560094021764",appId:"1:560094021764:web:d9efaf85f4747eb1"}),R={apiKey:T.apiKey,authDomain:T.authDomain,databaseURL:T.databaseUrl,projectId:T.projectId,storageBucket:T.storageBucket,messagingSenderId:T.messagingSenderId,appId:T.appId};N.a.initializeApp(R),N.a.firestore().enablePersistence().catch(function(e){"failed-precondition"===e.code?console.log(e.code):"unimplemented"===e.code&&console.log(e.code)});var D=N.a,I=N.a.firestore(),P=function(){return{type:"LOGOUT",payload:{}}},U=function(){return{type:"SET_POSTS",payload:{allPosts:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}},L=Object(v.a)({root:{},grow:{flexGrow:1},avatar:{margin:0,padding:0,height:"24px",width:"24px"}})(function(e){var t=e.classes,n=r.a.useState(null),a=Object(h.a)(n,2),o=a[0],i=a[1],c=Boolean(o),u=Object(g.c)(function(e){return e.user}),s=Object(g.b)();return r.a.createElement("div",{className:t.root},r.a.createElement(E.a,{position:"static"},r.a.createElement(w.a,null,r.a.createElement(O.a,{variant:"h6",color:"inherit",className:t.grow},"Pai"),r.a.createElement(j.a,{color:"inherit",onClick:function(e){u.authenticated&&i(e.currentTarget)}},u.authenticated?r.a.createElement(x.a,{alt:"Remy Sharp",src:u.data.photoURL,className:t.avatar}):r.a.createElement(y.a,null,"account_circle")),r.a.createElement(S.a,{id:"menu-appbar",anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:c,onClose:function(){i(null)}},r.a.createElement(k.a,{onClick:function(){i(null),D.auth().signOut(),s(P())}},"Sign out")))))}),B=Object(v.a)(function(e){return{appBar:{top:"auto",bottom:0},toolbar:{alignItems:"center",justifyContent:"space-between"}}})(function(e){var t=e.classes;return r.a.createElement(E.a,{position:"sticky",color:"primary",className:t.appBar},r.a.createElement(w.a,{className:t.toolbar,variant:"dense"},r.a.createElement(j.a,{color:"inherit","aria-label":"Open drawer",onClick:e.toggleDrawer(!0)},r.a.createElement(y.a,null,"menu")),e.camera))}),W=n(38),A=(n(64),n(83),n(55)),F=n(84),z=function(e){var t=((new Date).getTime()-e.getTime())/1e3;return t<60?parseInt(t)+"s":t<3600?parseInt(t/60)+"m":t<=172800?parseInt(t/3600)+"h":t>86400?"< 2 days":void 0},M=function(e){var t=100-((new Date).getTime()/1e3-e.getTime()/1e3)/86400*100;return t<0?0:t>100?100:t},V=function(e,t,n,a){var r="images/"+t.uid+"/"+function(e){return Date.now()+e.name.substr(e.name.lastIndexOf("."))}(e);D.storage().ref(r).put(e,{cacheControl:"max-age=432001",contentType:e.type}).on("state_changed",function(e){},function(e){},function(){_(r,t,n,a)})},_=function(e,t,n,a){var r=I.batch();n.forEach(function(n){var a=I.collection("posts").doc();r.set(a,{uid:t.uid,userPhotoURL:t.photoURL,imgRef:e,timestamp:D.firestore.FieldValue.serverTimestamp(),groupId:n})}),r.commit().then(function(e){q(t.uid).then(function(){a()})}).catch(function(e){console.error("Error adding document: ",e)})},q=function(e){return I.collection("users").doc(e).update({lastUpdate:D.firestore.FieldValue.serverTimestamp()})},J=function(e){return I.collection("posts").where("timestamp",">",new Date(Date.now()-864e5)).where("groupId","in",e).orderBy("timestamp","desc").limit(15).get().then(function(e){var t=[];return e.forEach(function(e){t.push(Object(W.a)({},e.data(),{postId:e.id}))}),t})},G=function(e){return I.collection("posts").where("timestamp",">",new Date(new Date-864e5)).where("uid","==",e).orderBy("timestamp","desc").limit(1).get().then(function(e){var t;return e.forEach(function(e){t=e.data()}),t})},H=n(85),K=n.n(H),Y=n(86),X=n.n(Y),$=n(178),Z=Object(b.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"},touchActionNone:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00",touchAction:"none"}}}),Q=function(e){var t=Z(),n=Object(g.c)(function(e){return e.user.data.uid}),o=e.canvasDrawing,c=e.imageWrapperRef,u=e.postId,s=e.drawEnabled,l=Object(a.useRef)(),d=Object(a.useRef)([]),f=!1,p=Object(a.useRef)(),m=Object(a.useRef)(),h=Object(a.useCallback)(function(e,t){var n=l.current.getContext("2d");d.current.push({x:e,y:t}),n.beginPath(),n.strokeStyle="red",n.lineWidth=3,n.lineJoin="round",n.moveTo(p.current,m.current),n.lineTo(e,t),n.stroke(),n.closePath(),p.current=e,m.current=t},[]),b=Object(a.useCallback)(function(){p.current=void 0,m.current=void 0},[]);Object(a.useEffect)(function(){new ResizeObserver(function(e){v(),o&&l.current?(d.current=[],b(),l.current.getContext("2d").clearRect(0,0,l.width,l.height),o.forEach(function(e){"up"===e?(d.current.push("up"),b()):h(e.x,e.y)})):d.current=[]}).observe(c.current)},[c,o,h,b]);var v=function(){l.current&&(l.current.style.width="100%",l.current.style.height="100%",l.current.width=l.current.offsetWidth,l.current.height=l.current.offsetHeight)},E=function(e,t){s&&("down"===e&&w(t),"move"===e&&O(t),"up"===e&&k(t))},w=function(e){f=!0},O=function(e){e.preventDefault();var t=function(e){var t=i.a.findDOMNode(l.current).getBoundingClientRect(),n=e.clientX,a=e.clientY;return e.changedTouches&&e.changedTouches.length>0&&(n=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY),{x:n-t.left,y:a-t.top}}(e),n=t.x,a=t.y;j(n,a)&&h(n,a)},j=function(e,t){return!(!f||!y(e,t))},y=function(e,t){return!m.current||!m.current||!(!x(e,p.current)&&!x(t,m.current))||void 0},x=function(e,t){return e-t>10||t-e>10},k=function(e){f&&(d.current.push("up"),b(),console.log("save",d.current),function(e,t,n){I.collection("posts").doc(t).update(Object(A.a)({},"canvasDrawings.".concat(n),e))}(d.current,u,n)),f=!1};return r.a.createElement("canvas",{className:s?t.touchActionNone:t.canvas,onMouseDown:function(e){return E("down",e)},onTouchStart:function(e){return E("down",e)},onMouseMove:function(e){return E("move",e)},onTouchMove:function(e){return E("move",e)},onMouseUp:function(e){return E("up",e)},onTouchEnd:function(e){return E("up",e)},onMouseOut:function(e){return E("up",e)},onTouchCancel:function(e){return E("up",e)},ref:l})},ee=Object(b.a)(function(e){return{canvas:{position:"absolute",top:"0px",left:"0",backgroundColor:"#ffffff00"}}}),te=function(e){var t=e.canvasDrawings,n=e.imageWrapperRef,o=Object(a.useRef)(),i=ee(),c=Object(a.useRef)(),u=Object(a.useRef)(),s=Object(a.useCallback)(function(e,t){var n=o.current.getContext("2d");n.beginPath(),n.strokeStyle="red",n.lineWidth=3,n.lineJoin="round",n.moveTo(c.current,u.current),n.lineTo(e,t),n.stroke(),n.closePath(),c.current=e,u.current=t},[]),l=Object(a.useCallback)(function(){c.current=void 0,u.current=void 0},[]);Object(a.useEffect)(function(){new ResizeObserver(function(e){d(),function(){if(t&&o.current){l();var e=o.current.getContext("2d");for(var n in e.clearRect(0,0,o.width,o.height),t)t[n].forEach(function(e){"up"===e?l():s(e.x,e.y)})}}()}).observe(n.current)},[n,s,t,l]);var d=function(){o.current&&(o.current.style.width="100%",o.current.style.height="100%",o.current.width=o.current.offsetWidth,o.current.height=o.current.offsetHeight)};return r.a.createElement("canvas",{className:i.canvas,ref:o})},ne=Object(b.a)(function(e){return{imgDiv:{position:"relative",borderRadius:"4px",minHeight:"250px",maxHeight:"75vh",maxWidth:"450px",overflow:"hidden"},img:{borderRadius:"4px",boxShadow:"0px 1px 3px 0px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 2px 1px -1px rgba(0,0,0,0.12)"},progressWrapper:{widh:"100%",height:"250px",display:"flex",justifyContent:"center",alignItems:"center"},progress:{color:e.palette.color.main}}}),ae=function(e){var t=Object(a.useState)(""),n=Object(h.a)(t,2),o=n[0],i=n[1],c=Object(a.useState)(!1),u=Object(h.a)(c,2),s=u[0],l=u[1],d=Object(a.useRef)(),f=ne(),p=Object(g.c)(function(e){return e.user.data.uid}),m=e.imageRef,b=e.renderNextImages,v=e.renderImages,E=e.index,w=e.drawEnabled,O=e.postId,j=e.canvasDrawings;Object(a.useEffect)(function(){return y(m)},[m]);var y=function(e){(function(e){if(e)return D.storage().ref(e).getDownloadURL().then(function(e){return e})})(e).then(function(e){return i(e)})};return r.a.createElement(X.a,{onChange:function(e){l(e),e&&b(E)},active:!s},r.a.createElement("div",{className:f.imgDiv,ref:d},E<=v?r.a.createElement(K.a,{width:"100%",height:"auto",src:o,alt:"image post",className:f.img,loader:r.a.createElement("div",{className:f.progressWrapper},r.a.createElement($.a,{className:f.progress}))}):"",r.a.createElement(te,{canvasDrawings:function(){if(j){var e=Object.assign({},j);return delete e[p],e}}(),imageWrapperRef:d}),r.a.createElement(Q,{drawEnabled:w,imageWrapperRef:d,postId:O,canvasDrawing:j&&j[p]})))},re=n(144),oe=Object(re.a)(function(e){return{progress:{marginLeft:"5px",color:e.palette.color.main,zIndex:2},innerProgress:{position:"relative",marginLeft:"-16px",color:e.palette.gray.main,zIndex:1}}}),ie=function(e){var t=oe(),n=e.timestamp;return r.a.createElement(a.Fragment,null,r.a.createElement(O.a,{variant:"caption"},z(n.toDate())),r.a.createElement($.a,{color:"primary",variant:"static",value:M(n.toDate()),className:t.progress,size:16}),r.a.createElement($.a,{variant:"static",value:100,className:t.innerProgress,size:16}))},ce=Object(b.a)(function(e){return{icon:{position:"absolute",bottom:"-16px",right:"8px"}}}),ue=function(e){var t=e.editDrawEnabled,n=e.drawEnabled,a=ce();return r.a.createElement(y.a,{fontSize:"large",className:a.icon,onClick:t,color:n?"secondary":"disabled"},"brush")},se=Object(b.a)(function(e){return{root:{scrollSnapAlign:"start",padding:"0px",height:"82vh",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},postWrapper:{position:"relative",width:"100%",maxWidth:"450px"},avatar:{border:"2px solid #fafafa",marginLeft:"6px"},avatarTimeDiv:{position:"relative",zIndex:2,display:"flex",marginBottom:"-21px"}}}),le=function(e){var t=se(),n=Object(a.useState)(!1),o=Object(h.a)(n,2),i=o[0],c=o[1],u=e.post,s=e.renderNextImages,l=e.renderImages,d=e.index;return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.postWrapper},r.a.createElement("div",{className:t.avatarTimeDiv},r.a.createElement(x.a,{className:t.avatar,alt:"Post Avatar",src:u.userPhotoURL}),r.a.createElement(ie,{timestamp:u.timestamp})),r.a.createElement(ae,{drawEnabled:i,imageRef:u.imgRef,renderNextImages:s,renderImages:l,index:d,canvasDrawings:u.canvasDrawings,postId:u.postId}),r.a.createElement(ue,{editDrawEnabled:function(){c(!i)},drawEnabled:i})))},de=Object(b.a)(function(e){return{root:{padding:"0px",height:"78vh",display:"flex",flexDirection:"column",justifyContent:"space-around",textAlign:"center",alignItems:"center"},"@keyframes arrowAnimation":{from:{transform:"translateY(0)"},to:{transform:"translateY(30px)"}},icon:{position:"relative",fontSize:"65px",animation:"$arrowAnimation 2s infinite alternate"}}}),fe=function(){var e=de();return r.a.createElement("div",{className:e.root},r.a.createElement("div",null),r.a.createElement("span",null,r.a.createElement(O.a,{align:"center",variant:"h4"},"Show friends what you are up to.",r.a.createElement("br",null)," Post a picture.")),r.a.createElement(y.a,{color:"disabled",className:e.icon,fontSize:"large"},"arrow_downward"))},pe=n(143),me=function(e){var t=he();return e.members.map(function(e,n){return r.a.createElement(x.a,{key:"key"+n,alt:"Avatar photo",src:e.photoURL,className:t.avatar})})},he=Object(b.a)(function(e){return{groupWrapper:{display:"flex",width:"100%",scrollSnapAlign:"start"},avatar:{marginLeft:"-6px",border:"2px solid white"},listItemWrapper:{display:"flex"},leftAvatarsLine:{width:"100%",borderTop:"1px solid white",marginLeft:"8px",marginTop:"35px",height:"16px"},rightAvatarsLine:{width:"100%",borderTop:"1px solid white",marginRight:"8px",marginTop:"35px",height:"16px"}}}),ge=function(e){var t=e.group,n=he();return r.a.createElement("div",{className:n.groupWrapper},r.a.createElement("div",{className:n.leftAvatarsLine}),r.a.createElement("div",{className:n.listItemWrapper},r.a.createElement(pe.a,null,me(t))),r.a.createElement("div",{className:n.rightAvatarsLine}))},be=Object(b.a)(function(e){return{feedWrapper:{display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:e.palette.background.main},feedTopDiv:{scrollSnapAlign:"end"}}}),ve=function(e){var t=Object(a.useState)(!0),n=Object(h.a)(t,2),o=n[0],i=n[1],c=Object(a.useState)(!0),u=Object(h.a)(c,2),s=u[0],l=u[1],d=Object(a.useState)(2),f=Object(h.a)(d,2),p=f[0],m=f[1],b=be(),v=Object(g.c)(function(e){return e.user}),E=Object(g.c)(function(e){return e.feed}),w=Object(g.c)(function(e){return e.groups}),j=Object(g.b)(),y=0,x=function(e){m(e+2)};Object(a.useEffect)(function(){if(e.gotLatestPost&&w&&w.length){if(e.latestValidPost){i(!0);var t=w.map(function(e){return e.id});J(t).then(function(e){j(U(e))})}else i(!1);l(!1)}else l(!0)},[e.latestValidPost,e.gotLatestPost,j,w]),Object(a.useEffect)(function(){if(e.updateFeed&&w&&w.length){var t=w.map(function(e){return e.id});J(t).then(function(e){return j(U(e))}),i(!0)}},[e.updateFeed,v,j,w]);var k=function(e,t){return r.a.createElement(a.Fragment,{key:"key"+t},r.a.createElement(ge,{group:e}),S(e.id))},S=function(e){return E.allPosts.filter(function(t){return t.groupId===e}).map(function(e,t){return y++,r.a.createElement(le,{key:"post"+t,renderNextImages:x,renderImages:p,index:y,post:e})})};return r.a.createElement("div",{className:b.feedWrapper},r.a.createElement("div",{className:b.feedTopDiv}),s?r.a.createElement(O.a,{variant:"subtitle1"},"loading"):o?(y++,w.map(function(e,t){return k(e,t)})):r.a.createElement(fe,null))},Ee=n(184),we=n(185),Oe=n(179);function je(e){return r.a.createElement(Oe.a,Object.assign({},e,{direction:"right"}))}var ye=function(e){return r.a.createElement(we.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:1300,open:e.showSnackBar,onClose:e.handleCloseSnackBar,TransitionComponent:je,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},e.snackBarText),action:[r.a.createElement(j.a,{key:"close","aria-label":"close",color:"inherit",onClose:e.handleCloseSnackBar},r.a.createElement(y.a,null,"close"))]})},xe=n(180),ke=function(){var e=Object(g.c)(function(e){return e.user});return r.a.createElement(a.Fragment,null,"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===e.data.uid?r.a.createElement(xe.a,{color:"secondary",onClick:function(){e.authenticated&&e.data&&function(e){I.collection("groups").add({uidList:[e.uid],members:[{uid:e.uid,photoURL:e.photoURL,displayName:e.displayName}]})}(e.data)}},"Create Group ",r.a.createElement(y.a,null,"add")):"")},Se=n(176),Ce=function(e,t){if(e&&t){var n=t.filter(function(t){return t.uid===e}).sort(function(e,t){return e.timestamp.toDate().getTime()-t.timestamp.toDate().getTime()});return n[0]?z(n[n.length-1].timestamp.toDate()):"\ud83d\ude34"}},Ne=Object(b.a)(function(e){return{loadingText:{marginLeft:"16px"},avatar:{marginLeft:"-6px",border:"2px solid white"},groupButtonWrapper:{display:"flex",alignItems:"center"},timer:{margin:0}}}),Te=function(e){var t=Ne(),n=Object(g.c)(function(e){return e.groups}),a=Object(g.c)(function(e){return e.user}),o=Object(g.c)(function(e){return e.feed}).allPosts,i=function(e,n){return r.a.createElement("div",{key:"key"+n,className:t.groupButtonWrapper},r.a.createElement(pe.a,null,c(e)),"CtJDRqu7FUf6OReDg8ztcTo1wmv2"===a.data.uid?r.a.createElement(j.a,{onClick:function(){return u(e.id)}},r.a.createElement(y.a,null,"group_add")):"")},c=function(e){return e.members.map(function(e,n){return r.a.createElement("div",{key:"avatar"+n},r.a.createElement(x.a,{onClick:function(){return s(e)},key:"key"+n,alt:"Avatar photo",src:e.photoURL,className:t.avatar}),r.a.createElement("p",{className:t.timer},Ce(e.uid,o)))})},u=function(e){var t=window.location.href+"?groupId="+e;navigator.clipboard.writeText(t).then(function(){},function(e){console.error("Async: Could not copy text: ",e)})},s=function(t){e.setShowSnackBar(!0,"Notification to "+t.displayName),function(e){var t=D.functions().httpsCallable("sendPushNotificationTest");return t({toUid:e})}(t.uid).then(function(t){var n=t.data?"Sent Notification!":"Couldn't send notification";e.setShowSnackBar(!0,n)})};return r.a.createElement(Se.a,null,n?n.map(function(e,t){return i(e,t)}):r.a.createElement(O.a,{variant:"body2",color:"inherit",className:t.loadingText},"loading groups.."))},Re=Object(b.a)(function(e){return{drawerList:{height:"100%",width:"250px",display:"flex",flexDirection:"column",justifyContent:"space-between",backgroundColor:e.palette.background.main}}}),De=function(e){var t=e.open,n=e.toggleDrawer,o=Re(),i=Object(a.useState)(!1),c=Object(h.a)(i,2),u=c[0],s=c[1],l=Object(a.useState)("Push Notification"),d=Object(h.a)(l,2),f=d[0],p=d[1];return r.a.createElement(a.Fragment,null,r.a.createElement(ye,{handleCloseSnackBar:function(){s(!1)},showSnackBar:u,snackBarText:f}),r.a.createElement(Ee.a,{open:t,onClose:n(!1),onOpen:n(!0)},r.a.createElement("div",{tabIndex:0,role:"button",onClick:n(!1),onKeyDown:n(!1),className:o.drawerList},r.a.createElement(Te,{setShowSnackBar:function(e,t){s(e),p(t)}}),r.a.createElement(ke,null),r.a.createElement(O.a,{variant:"body2",gutterBottom:!0},"Beta v.0.1.5"))))},Ie=n(181),Pe=Object(v.a)(function(e){return{fabButton:{position:"absolute",zIndex:2,top:"-29px",left:0,right:0,margin:"0 auto"},fabProgress:{position:"absolute",zIndex:1,top:-34,left:0,right:0,margin:"0 auto",color:e.palette.color.main},hide:{display:"none"}}})(function(e){var t=e.classes,n=Object(a.createRef)(),o=Object(a.useState)(0),i=Object(h.a)(o,2),c=i[0],u=i[1],s=r.a.useState(!1),l=Object(h.a)(s,2),d=l[0],f=l[1],p=Object(g.c)(function(e){return e.user});Object(a.useEffect)(function(){e.latestValidPost?u(M(e.latestValidPost.timestamp.toDate())):u(0)},[e.latestValidPost]);function m(e,t){"clickaway"!==t&&f(!1)}return r.a.createElement("div",null,r.a.createElement("span",{className:t.hide},r.a.createElement("input",{type:"file",accept:"image/*",capture:!0,onChange:function(t){return e.handleFile(t)},ref:n})),r.a.createElement(Ie.a,{"aria-label":"Add",className:t.fabButton,size:"large",onClick:function(){p.authenticated?n.current.click():f(!0)}},r.a.createElement(y.a,null,"photo_camera")),r.a.createElement($.a,{size:66,variant:e.showUploadLoader?"indeterminate":"static",value:c,className:t.fabProgress}),r.a.createElement(we.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},message:r.a.createElement("span",{id:"message-id"},"Login to post pictures"),open:d,autoHideDuration:1e4,onClose:m,action:r.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:t.close,onClick:m},r.a.createElement(y.a,null,"close"))}))}),Ue=n(87),Le=n.n(Ue),Be=function(e){var t=Object(a.useState)(!1),n=Object(h.a)(t,2),o=n[0],i=n[1],c=Object(g.b)(),u={signInFlow:"popup",signInOptions:[D.auth.FacebookAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}};return Object(a.useEffect)(function(){D.auth();var e=D.auth().onAuthStateChanged(function(e){D.auth().setPersistence(D.auth.Auth.Persistence.LOCAL),c(function(e){return{type:"SET_USER",payload:{user:e}}}(e)),e||i(!0)});return function(){e()}},[]),r.a.createElement("div",null,o?r.a.createElement(Le.a,{uiConfig:u,firebaseAuth:D.auth()}):r.a.createElement(O.a,{variant:"subtitle1",style:{textAlign:"center"}},"authenticating"))},We=Object(b.a)(function(e){return{App:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"800px",width:"100%"}}}),Ae=function(e){var t=Object(a.useState)(!1),n=Object(h.a)(t,2),o=n[0],i=n[1],c=Object(a.useState)(""),u=Object(h.a)(c,2),s=u[0],l=u[1],d=Object(a.useState)(),f=Object(h.a)(d,2),p=f[0],m=f[1],b=Object(a.useState)(!1),v=Object(h.a)(b,2),E=v[0],w=v[1],O=Object(a.useState)(!1),j=Object(h.a)(O,2),y=j[0],x=j[1],k=Object(a.useState)(0),S=Object(h.a)(k,2),C=S[0],N=S[1],T=We(),R=Object(g.b)(),P=Object(g.c)(function(e){return e.user}),U=Object(g.c)(function(e){return e.groups}),W=function(e){return function(){i(e)}};Object(a.useEffect)(function(){P.authenticated&&G(P.data.uid).then(function(e){m(e),w(!0)})},[P]),Object(a.useEffect)(function(){var t,n;P.authenticated&&e.FCMToken&&(t=e.FCMToken,n=P.data.uid,I.collection("users").doc(n).update({FCMToken:t}))},[P,e.FCMToken]),Object(a.useEffect)(function(){var e=new URL(window.location.href).searchParams.get("groupId");e&&P.authenticated&&(window.history.pushState({},"","/"),function(e,t){I.collection("groups").doc(e).update({uidList:D.firestore.FieldValue.arrayUnion(t.uid),members:D.firestore.FieldValue.arrayUnion({uid:t.uid,photoURL:t.photoURL,displayName:t.displayName})})}(e,P.data))},[P,P.authenticated]),Object(a.useEffect)(function(){var e;P.authenticated&&P.data&&(e=P.data.uid,I.collection("groups").where("uidList","array-contains",e).get().then(function(e){var t=[];return e.forEach(function(e){var n=e.data();n.id=e.id,t.push(n)}),t})).then(function(e){R(function(e){return{type:"SET_GROUPS",payload:{groups:e}}}(e))})},[P,R]);var A=function(e){return e.map(function(e){return e.id})},z=function(){x(!1),N(C+1),G(P.data.uid).then(function(e){m(e),w(!0)})};return r.a.createElement("div",{className:T.App},r.a.createElement(L,null),P.authenticated?r.a.createElement(a.Fragment,null,r.a.createElement(De,{open:o,toggleDrawer:W}),r.a.createElement(ve,{imagePreviewUrl:s,latestValidPost:p,gotLatestPost:E,updateFeed:C})):r.a.createElement(Be,null),r.a.createElement(B,{toggleDrawer:W,camera:r.a.createElement(Pe,{showUploadLoader:y,handleFile:function(e){var t=e.target.files[0];if(t||!P.authenticated){x(!0);var n=A(U);!function(e,t){e&&new F.a(e,{quality:.5,width:512,success:function(e){t(e)},error:function(e){console.log(e.message)}})}(t,function(e){l(URL.createObjectURL(e)),V(e,P.data,n,z)})}},latestValidPost:p})}))},Fe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ze(e){if("serviceWorker"in navigator){if(new URL("/paiweb",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/paiweb","/service-worker.js");Fe?(!function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Me(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Me(t,e)})}}function Me(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var Ve=function(e){return r.a.createElement("div",null,r.a.createElement(we.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:e.showUpdateSnackBar,onClose:e.handleCloseSnackBar,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},"New Update! Restart the app")}))};var _e=n(88),qe=n.n(_e),Je=n(41),Ge=[],He={authenticated:!1,data:{}},Ke={allPosts:[]},Ye=Object(Je.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":var n=t.payload.user;return Object(W.a)({},e,{authenticated:!!n,data:n});case"LOGOUT":return Object(W.a)({},e,{authenticated:!1,data:{}});default:return e}},groups:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GROUPS":return t.payload.groups;default:return e}},feed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POSTS":var n=t.payload.allPosts;return Object(W.a)({},e,{allPosts:n});default:return e}}}),Xe=Object(Je.c)(Ye),$e=qe.a.messaging(),Ze=Object(f.a)({palette:{type:"dark",background:{main:"#000000"},primary:{main:"#000000"},secondary:{main:"#ffffff"},color:{main:"#FF2188"},gray:{main:"#666666"}},typography:{useNextVariants:!0}}),Qe=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).handleServiceWorkerUpdate=function(e){n.setState({showUpdateSnackBar:!0})},n.handleCloseSnackBar=function(e,t){"clickaway"!==t&&n.setState({showUpdateSnackBar:!1})},n.state={showUpdateSnackBar:!1,FCMToken:""},"serviceWorker"in navigator&&navigator.serviceWorker.register("./fbsw/firebase-messaging-sw.js").then(function(e){$e.useServiceWorker(e),function(e){return e.requestPermission().then(function(){return e.getToken()})}($e).then(function(e){n.setState({FCMToken:e})}).catch(function(e){"messaging/permission-blocked"===e.code?console.log("Please Unblock Notification Request Manually"):console.log("Error Occurred",e)})}).catch(function(e){console.log("Service worker registration failed, error:",e)}),ze({onUpdate:n.handleServiceWorkerUpdate}),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,{theme:Ze},r.a.createElement(m.a,null),r.a.createElement(g.a,{store:Xe},r.a.createElement(Ae,{FCMToken:this.state.FCMToken})),r.a.createElement(Ve,{handleCloseSnackBar:this.handleCloseSnackBar,showUpdateSnackBar:this.state.showUpdateSnackBar}))}}]),t}(a.Component);i.a.render(r.a.createElement(Qe,null),document.getElementById("root"))}},[[101,1,2]]]);
//# sourceMappingURL=main.9e4db43e.chunk.js.map